<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SLATE | Articles</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <!-- Firebase Imports (Required for Firestore and Auth) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // --- GLOBAL FIREBASE VARIABLES ---
        window.firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        window.initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        window.appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        // Initialization Logic
        if (Object.keys(window.firebaseConfig).length > 0) {
            window.app = initializeApp(window.firebaseConfig);
            window.db = getFirestore(window.app);
            window.auth = getAuth(window.app);

            // Anonymous Sign-in (Must sign in first to get a userId)
            if (!window.auth.currentUser) {
                signInAnonymously(window.auth).catch((error) => {
                    console.error("Firebase Anonymous Auth Failed:", error);
                });
            }
        }
        
        // Export necessary functions for use in the main script block
        window.addDownloadRecord = async (articleId, articleTitle, userName, userEmail, userOrganization) => {
            if (!window.db || !window.auth.currentUser) {
                console.error("Firestore not initialized or user not authenticated.");
                return false;
            }
            try {
                const userId = window.auth.currentUser.uid;
                const path = `/artifacts/${window.appId}/users/${userId}/download_requests`;
                
                await addDoc(collection(window.db, path), {
                    userId: userId,
                    articleId: articleId,
                    articleTitle: articleTitle,
                    userName: userName,
                    userEmail: userEmail,
                    userOrganization: userOrganization, // ADDED ORGANIZATION FIELD
                    timestamp: serverTimestamp()
                });
                console.log("Download record successfully added to Firestore.");
                return true;
            } catch (e) {
                console.error("Error adding document: ", e);
                return false;
            }
        };
    </script>
    
    <style>
        /* TAILWIND CONFIG */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
    </style>
    <style>
        /* --- INTEGRATED STYLE.CSS & COMPONENT STYLES (Copied from index.html) --- */

        /* GENERAL/BODY STYLES */
        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
        }

        /* CUSTOM SCROLLBAR (From style.css) */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #F3F4F6;
        }
        ::-webkit-scrollbar-thumb {
            background: #008080;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #006666;
        }

        /* BASE LAYOUT STYLES */
        .content-padding {
            padding-top: 80px; /* Pushes content down to clear the sticky header */
        }

        /* NAVBAR STYLES (Fixed, Utlity-focused) */
        nav {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            width: 100%;
            top: 0;
            left: 0;
            z-index: 1000;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            justify-content: space-between;
            flex-wrap: wrap;
            height: 80px; 
        }
        .brand-container {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            min-width: 280px;
        }
        .logo {
            color: #008080; /* Teal 500 */
            font-weight: 800;
            font-size: 1.5rem;
            letter-spacing: -0.5px;
            text-transform: uppercase;
            line-height: 1;
            white-space: nowrap;
        }
        .datetime-display {
            font-size: 0.9rem;
            color: #374151; /* Slate 800 */
            display: flex;
            gap: 0.5rem;
            align-items: center;
            border-left: 2px solid #008080;
            padding-left: 1rem;
        }
        .time-display {
            font-weight: 600;
            color: #008080; /* Teal 500 */
        }
        .date-display {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        .nav-main {
            display: flex;
            align-items: center;
            flex-grow: 1; 
            justify-content: flex-end; 
            gap: 3rem;
        }
        .nav-links {
            display: flex;
            align-items: center; 
            justify-content: space-between;
            max-width: 600px; 
            width: 100%; 
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .nav-links > li > a {
            padding: 0.5rem 0; 
            display: block;
        }
        .nav-links a {
            color: #374151; 
            text-decoration: none;
            font-weight: 500;
            position: relative;
            transition: all 0.3s;
            white-space: nowrap;
        }
        .nav-links a:hover::after {
            width: 100%;
        }
        .search-bar-container {
            display: flex;
            align-items: center;
            min-width: 240px;
            position: relative;
        }
        .search-input {
            border: 2px solid #008080;
            border-radius: 6px;
            padding: 0.5rem 0.75rem 0.5rem 2.5rem;
            width: 100%;
            background: white;
            transition: all 0.3s;
        }

        /* --- DROPDOWN STYLES (ENHANCED) --- */
        .dropdown {
            position: relative;
            display: flex; 
            align-items: center;
            height: 100%; 
        }
        .dropdown-menu {
            display: none;
            position: absolute;
            top: 100%; 
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            background-color: #f7f7f7; 
            min-width: 220px; 
            border-radius: 0.5rem;
            box-shadow: 0 6px 20px rgba(0, 128, 128, 0.2); 
            border-top: 3px solid #008080;
            padding: 0; 
            margin-top: 0.5rem;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .dropdown:hover .dropdown-menu {
            display: block;
            opacity: 1;
            visibility: visible;
        }
        .dropdown-item {
            display: block;
            padding: 0.75rem 1.5rem; 
            color: #374151;
            font-weight: 500;
            text-align: center;
            border-bottom: 1px solid #e0e0e0; 
            transition: background-color 0.2s, color 0.2s;
        }
        .dropdown-item:last-child {
            border-bottom: none;
        }
        .dropdown-item:hover {
            background-color: #008080; 
            color: white; 
            font-weight: 600;
        }
        .dropdown-trigger {
            color: #374151;
            text-decoration: none;
            font-weight: 500;
            cursor: pointer;
            padding: 0.5rem 0; 
            display: flex; 
            align-items: center;
            transition: color 0.3s;
            height: 100%;
        }
        .dropdown-trigger:hover {
            color: #008080;
        }
        .dropdown-trigger i {
            margin-left: 0.25rem;
        }
        /* --- END DROPDOWN STYLES --- */


        /* FOOTER STYLES */
        .footer-style {
            background: #1a202c; 
            color: white;
            padding: 4rem 2rem 2rem;
            text-align: center;
        }
        .footer-logo {
            color: #008080; 
            font-weight: 700;
            font-size: 1.5rem; 
            margin-bottom: 0.5rem; 
            text-transform: uppercase;
        }
        .footer-name {
            font-size: 1.1rem; 
            font-weight: 500;
            color: #e5e7eb; 
            margin-bottom: 1rem; 
        }
        .copyright {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid #374151;
            text-align: center;
            font-size: 0.875rem;
            color: #9ca3af;
        }
        .footer-links {
            text-align: left; 
        }
        .footer-links h3 {
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 1.5rem;
            color: #008080;
        }
        .footer-links ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .footer-links li {
            margin-bottom: 0.75rem;
        }
        .footer-links a {
            color: #e5e7eb;
            text-decoration: none;
            transition: color 0.3s;
        }
        .footer-links a:hover {
            color: #008080;
        }
        .social-links {
            display: flex;
            gap: 1rem;
            justify-content: center; 
        }
        .social-links a {
            color: white;
            background: #374151;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        .social-links a:hover {
            background: #008080;
            transform: translateY(-3px);
        }
        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 600px; 
            margin: 0 auto;
            gap: 2rem;
        }
        @media (min-width: 768px) {
            .footer-content {
                flex-direction: row;
                justify-content: space-between;
                align-items: flex-start;
                max-width: 800px;
                text-align: left;
            }
            .footer-about {
                text-align: left;
            }
            .social-links {
                justify-content: flex-start;
            }
        }
        /* Page Header Styles */
        .page-header {
            background-color: #f3f4f6;
            padding: 4rem 2rem;
            text-align: center;
            border-bottom: 3px solid #008080;
        }
        .page-header h1 {
            font-size: 3rem;
            font-weight: 800;
            color: #008080;
            margin-bottom: 0.5rem;
        }
        .page-header p {
            font-size: 1.25rem;
            color: #4B5563;
        }
        /* Main Content Placeholder Styles */
        .main-content-placeholder {
            min-height: 400px;
            padding: 4rem 2rem;
            background-color: white;
            text-align: center;
        }
        .placeholder-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 1rem;
        }
        .placeholder-cta {
            font-size: 1.1rem;
            color: #6B7280;
            line-height: 1.6;
        }
        /* --- PDF Viewer and Form Styles --- */
        .pdf-viewer-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 2rem;
            width: 100%;
        }
        .article-list-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        .article-card {
            background-color: #f7f7f7;
            border-radius: 0.75rem;
            padding: 1.5rem;
            border-left: 4px solid #008080;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        .article-card h4 {
            font-weight: 600;
            color: #1a202c;
            margin-bottom: 0.5rem;
        }
        .viewer-box {
            width: 100%;
            height: 600px;
            margin-top: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        .download-link-box {
            margin-top: 1rem;
            padding: 1rem;
            background-color: #e5f5f5;
            border: 1px solid #008080;
            border-radius: 0.5rem;
        }
        /* Modal Overrides */
        #download-form input, #download-form textarea {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-bottom: 1rem;
        }
        #download-form label {
            display: block;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 0.25rem;
            text-align: left;
            color: #374151;
        }
        /* AI Chat Panel Styles (Copied from Analytics) */
        .article-main-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
        }
        @media (min-width: 1024px) {
            .article-main-grid {
                grid-template-columns: 2fr 1fr; /* Article List/Viewer Left, Chat Right */
            }
        }
        .chat-panel-container {
            height: 100%;
            display: flex;
            flex-direction: column;
            background-color: #FAFAFA;
            border-radius: 0.75rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            padding: 1rem;
        }
        .chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 0.5rem;
            min-height: 400px;
            max-height: 400px; 
            border-bottom: 1px solid #e0e0e0;
            margin-bottom: 1rem;
        }
        .chat-message {
            margin-bottom: 0.75rem;
            display: flex;
            align-items: flex-start;
        }
        .chat-user {
            justify-content: flex-end;
        }
        .chat-ai-icon {
            width: 32px;
            height: 32px;
            margin-right: 0.5rem;
            background-color: #059669; 
            border-radius: 50%;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 4px;
        }
        .chat-bubble {
            max-width: 85%;
            padding: 0.6rem 0.9rem;
            border-radius: 0.75rem;
            font-size: 0.875rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .chat-user .chat-bubble {
            background-color: #008080;
            color: white;
            border-bottom-right-radius: 0;
        }
        .chat-ai .chat-bubble {
            background-color: #E5E7EB;
            color: #1a202c;
            border-bottom-left-radius: 0;
        }
        .chat-loading {
             animation: pulse 1.5s infinite;
             background-color: #ccc;
             width: 40px;
             height: 20px;
             border-radius: 10px;
        }

        /* --- MODAL STYLES (Copied from index.html) --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            display: none; /* Initially hidden */
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        .modal-content {
            background-color: white;
            padding: 3rem 2rem;
            border-radius: 0.75rem;
            max-width: 90%;
            width: 500px;
            box-shadow: 0 10px 30px rgba(0, 128, 128, 0.5);
            text-align: center;
            position: relative;
            animation: modalPop 0.3s ease-out;
        }
        @keyframes modalPop {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        /* END CUSTOM STYLES */
    </style>
</head>
<body class="bg-slate-100 text-slate-800 font-sans">
    
    <!-- Navigation Bar (Fixed) -->
    <nav class="fixed top-0 left-0 right-0 z-50 bg-white shadow-md">
        <div class="container mx-auto px-6 py-3 flex items-center justify-between">
            
            <!-- Left Zone - Branding & Data -->
            <div class="brand-container">
                <div class="logo">SLATE</div>
                <div class="datetime-display">
                    <span id="time" class="time-display"></span>
                    <span id="date" class="date-display"></span>
                </div>
            </div>

            <!-- Right Zones - Navigation and Search -->
            <div class="nav-main">
                <ul class="nav-links">
                    <li><a href="index.html">Home</a></li>
                    
                    <!-- Dropdown 1: Insights & Analytics -->
                    <li class="dropdown">
                        <div class="dropdown-trigger">Insights & Analytics <i data-feather="chevron-down" class="ml-1 w-4 h-4 inline-block"></i></div>
                        <div class="dropdown-menu">
                            <a href="reports.html" class="dropdown-item">Reports</a>
                            <a href="analytics.html" class="dropdown-item">Analytics</a>
                            <a href="papers.html" class="dropdown-item">Papers</a>
                            <a href="articles.html" class="dropdown-item">Articles</a>
                        </div>
                    </li>
                    
                    <!-- Dropdown 2: Energy Nexus (STILL USES MODAL) -->
                    <li class="dropdown">
                        <div class="dropdown-trigger">Energy Nexus <i data-feather="chevron-down" class="ml-1 w-4 h-4 inline-block"></i></div>
                        <div class="dropdown-menu">
                            <a href="policy.html" class="dropdown-item">Policy Updates</a>
                            <a href="digital.html" class="dropdown-item">Digital Energy Solutions</a>
                            <a href="project.html" class="dropdown-item">Project Spotlights</a>
                        </div>
                    </li>
                    
                    <li><a href="index.html#contact">Let's Connect</a></li>
                </ul>
                
                <div class="search-bar-container relative hidden lg:block">
                    <input type="text" placeholder="Search reports..." class="search-input">
                    <i data-feather="search" class="absolute left-3 top-1/2 -translate-y-1/2 text-teal-500 w-5 h-5"></i>
                </div>
            </div>
        </div>
    </nav>
    
    <div class="content-padding">
        
        <div class="page-header">
            <h1>Articles</h1> <!-- Updated Title -->
            <p>In-depth articles available for viewing, with controlled access to downloadable PDFs.</p>
        </div>

        <section class="max-w-7xl mx-auto py-12 px-4">
            
            <div class="article-main-grid">
                
                <!-- Article List and PDF Viewer (Left/Main Column) -->
                <div class="lg:col-span-2">
                    <!-- Article List -->
                    <div class="article-list-grid">
                        <!-- Article 1 Card -->
                        <div class="article-card" data-id="article_1" data-title="Domestic Market Pathways and Carbon Abatement">
                            <h4>Domestic Market Pathways and Carbon Abatement</h4>
                            <p class="text-gray-500 text-sm mb-3">Analysis of market adoption routes and regulatory hurdles for Green Hydrogen/Ammonia.</p>
                            <a href="#" onclick="viewArticle('article_1')" class="text-teal-500 font-medium inline-flex items-center hover:text-teal-600 mr-4">
                                View Article
                                <i data-feather="eye" class="ml-1 w-4 h-4"></i>
                            </a>
                            <a href="#" onclick="openDownloadModal(event, 'article_1', 'Domestic Market Pathways and Carbon Abatement')" class="text-indigo-500 font-medium inline-flex items-center hover:text-indigo-600">
                                Download PDF
                                <i data-feather="download" class="ml-1 w-4 h-4"></i>
                            </a>
                        </div>

                        <!-- Article 2 Card -->
                        <div class="article-card" data-id="article_2" data-title="Financing Green Ammonia in India Blended Finance">
                            <h4>Financing Green Ammonia in India Blended Finance</h4>
                            <p class="text-gray-500 text-sm mb-3">Exploring capital structures, blended finance, and risk mitigation strategies.</p>
                            <a href="#" onclick="viewArticle('article_2')" class="text-teal-500 font-medium inline-flex items-center hover:text-teal-600 mr-4">
                                View Article
                                <i data-feather="eye" class="ml-1 w-4 h-4"></i>
                            </a>
                            <a href="#" onclick="openDownloadModal(event, 'article_2', 'Financing Green Ammonia in India Blended Finance')" class="text-indigo-500 font-medium inline-flex items-center hover:text-indigo-600">
                                Download PDF
                                <i data-feather="download" class="ml-1 w-4 h-4"></i>
                            </a>
                        </div>

                        <!-- Article 3 Card -->
                        <div class="article-card" data-id="article_3" data-title="Reverse Auctions and Cost Discovery in India">
                            <h4>Reverse Auctions and Cost Discovery in India</h4>
                            <p class="text-gray-500 text-sm mb-3">A study on current auction mechanisms and their impact on project viability.</p>
                            <a href="#" onclick="viewArticle('article_3')" class="text-teal-500 font-medium inline-flex items-center hover:text-teal-600 mr-4">
                                View Article
                                <i data-feather="eye" class="ml-1 w-4 h-4"></i>
                            </a>
                            <a href="#" onclick="openDownloadModal(event, 'article_3', 'Reverse Auctions and Cost Discovery in India')" class="text-indigo-500 font-medium inline-flex items-center hover:text-indigo-600">
                                Download PDF
                                <i data-feather="download" class="ml-1 w-4 h-4"></i>
                            </a>
                        </div>

                        <!-- Article 4 Card -->
                        <div class="article-card" data-id="article_4" data-title="Strategic Analysis of India’s Green Ammonia Market">
                            <h4>Strategic Analysis of India’s Green Ammonia Market</h4>
                            <p class="text-gray-500 text-sm mb-3">Comprehensive outlook on supply chains, demand drivers, and long-term trends.</p>
                            <a href="#" onclick="viewArticle('article_4')" class="text-teal-500 font-medium inline-flex items-center hover:text-teal-600 mr-4">
                                View Article
                                <i data-feather="eye" class="ml-1 w-4 h-4"></i>
                            </a>
                            <a href="#" onclick="openDownloadModal(event, 'article_4', 'Strategic Analysis of India’s Green Ammonia Market')" class="text-indigo-500 font-medium inline-flex items-center hover:text-indigo-600">
                                Download PDF
                                <i data-feather="download" class="ml-1 w-4 h-4"></i>
                            </a>
                        </div>
                    </div>

                    <!-- PDF Viewer Area -->
                    <div id="pdf-viewer-area" class="pdf-viewer-container hidden">
                        <h3 id="pdf-title" class="text-xl font-bold text-slate-800"></h3>
                        <div id="pdf-iframe-container" class="viewer-box">
                            <!-- The PDF will be embedded here -->
                        </div>
                        <div id="download-prompt" class="download-link-box text-center">
                            <p class="text-sm text-gray-700">To save this file, click the Download PDF button above and submit a quick request.</p>
                        </div>
                    </div>
                </div>

                <!-- AI Chat Panel (Right Column) -->
                <div class="lg:col-span-1">
                    <div class="chat-panel-container">
                        <h3 class="text-xl font-bold mb-3 text-slate-800 border-b pb-2">Greenie - Article Assistant</h3>
                        <div id="chat-messages-article" class="chat-messages">
                            <!-- Initial AI Message -->
                            <div class="chat-message chat-ai">
                                <div class="chat-ai-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4"><circle cx="12" cy="12" r="10"></circle><path d="M16 12l-4 4-4-4"></path><path d="M12 8v8"></path></svg>
                                </div>
                                <div class="chat-bubble">
                                    Hello! I'm Greenie, your Article Assistant. Ask me to summarize any of the four articles, or ask for the latest online information about these topics.
                                </div>
                            </div>
                        </div>
                        <form onsubmit="sendAIChatMessage(event, 'article')">
                            <div class="flex">
                                <input type="text" id="chat-input-article" placeholder="Ask Greenie for article insights..." class="w-full px-4 py-2 border border-gray-300 rounded-l-lg focus:ring-teal-500 focus:border-teal-500" required>
                                <button type="submit" class="bg-teal-500 hover:bg-teal-600 text-white font-medium py-2 px-4 rounded-r-lg">
                                    <i data-feather="send" class="w-5 h-5"></i>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

            </div>

        </section>
        
    </div>
    
    <!-- Footer Section -->
    <footer class="footer-style">
        <div class="footer-content">
            <div class="footer-about">
                <div class="footer-logo">SLATE</div>
                <div class="footer-name">Insights from Emil Roby</div>
                <div class="social-links">
                    <a href="https://www.linkedin.com/in/emil-roby-878792314/" target="_blank" rel="noopener noreferrer"><i data-feather="linkedin" class="w-4 h-4"></i></a>
                    <a href="mailto:emilroby9@gmail.com"><i data-feather="mail" class="w-4 h-4"></i></a>
                </div>
            </div>
            <!-- SERVICES SECTION -->
            <div class="footer-links">
                <h3>Services</h3>
                <ul>
                    <li><a href="#">Policy Analysis</a></li>
                    <li><a href="#">Strategic Consulting</a></li>
                    <li><a href="#">Energy Data Analytics</a></li>
                    <li><a href="#">Digital Energy Solutions</a></li>
                </ul>
            </div>
        </div>
        <div class="copyright">
            &copy; 2025 SLATE. All rights reserved.
        </div>
    </footer>

    <!-- --- DOWNLOAD REQUEST MODAL --- -->
    <div id="download-modal-overlay" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close" onclick="closeDownloadModal()">
                <i data-feather="x" class="w-6 h-6"></i>
            </button>
            <div class="modal-title">
                Request Download Access
            </div>
            <p class="modal-subtitle text-left">
                Please provide your details and the reason for downloading this report: <strong id="modal-download-title"></strong>.
            </p>

            <form id="download-form" onsubmit="handleDownloadSubmit(event)">
                <input type="hidden" id="form-article-id" value="">
                <input type="hidden" id="form-article-title" value="">
                
                <label for="form-name">Your Name</label>
                <input type="text" id="form-name" required>
                
                <label for="form-email">Your Email</label>
                <input type="email" id="form-email" required>

                <label for="form-organization">Your Organization</label>
                <input type="text" id="form-organization" required> <!-- ADDED ORGANIZATION FIELD -->

                <label for="form-reason">Reason for Download</label>
                <textarea id="form-reason" rows="3" placeholder="e.g., Market research, academic study, client proposal" required></textarea>

                <button type="submit" class="w-full bg-teal-500 hover:bg-teal-600 text-white font-medium py-3 px-4 rounded-lg transition-colors duration-300">
                    Submit Request & Get Link
                </button>
            </form>
            
            <div id="download-success" class="hidden mt-4">
                <p class="text-green-600 font-semibold mb-3">✅ Access Granted!</p>
                <a id="final-download-link" href="#" download class="bg-indigo-500 hover:bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg">
                    Click Here to Download
                </a>
            </div>
        </div>
    </div>


    
    <script>
        // --- PDF DATA STRUCTURE (Using GitHub /articles folder) ---
        // NOTE: These URLs must be the RAW links from GitHub or links from a public CDN/Storage bucket.
        const articleData = {
            'article_1': { 
                title: 'Domestic Market Pathways and Carbon Abatement',
                // FIX: Used encodeURIComponent and replaced spaces with %20 for robust URL construction
                url: encodeURIComponent('articles/Domestic Market Pathways and Carbon Abatement Economics of Green Ammonia.pdf').replace(/%20/g, ' ')
            },
            'article_2': { 
                title: 'Financing Green Ammonia in India Blended Finance',
                url: encodeURIComponent('articles/Financing Green Ammonia in India Blended Finance, CFDs, and Fiscal Incentives.pdf').replace(/%20/g, ' ')
            },
            'article_3': { 
                title: 'Reverse Auctions and Cost Discovery in India',
                url: encodeURIComponent('articles/Reverse Auctions and Cost Discovery in India’s Green Ammonia Sector.pdf').replace(/%20/g, ' ')
            },
            'article_4': { 
                title: 'Strategic Analysis of India’s Green Ammonia Market',
                url: encodeURIComponent('articles/Strategic Analysis of India’s Green Ammonia Market From Domestic Market and Export Perspectives.pdf').replace(/%20/g, ' ')
            }
        };

        let chatHistoryArticle = [];
        const ARTICLE_SYSTEM_INSTRUCTION = "You are Greenie, an expert Article Assistant. Use Google Search to provide context and answer questions related to the topics listed, such as Green Ammonia financing, Reverse Auctions, or Carbon Abatement. Be helpful and concise.";
        const API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=";


        // --- Core Application Logic ---

        function viewArticle(articleId) {
            const article = articleData[articleId];
            const viewerArea = document.getElementById('pdf-viewer-area');
            const iframeContainer = document.getElementById('pdf-iframe-container');
            const pdfTitle = document.getElementById('pdf-title');

            if (!article) {
                 console.error("Article data not found.");
                 return;
            }

            pdfTitle.textContent = article.title;
            
            // Clear previous content
            iframeContainer.innerHTML = '';

            // Create iframe for PDF viewing
            const embedElement = document.createElement('iframe');
            
            // FIX: The URL must be decoded here for the browser to read the path correctly,
            // but the original paths used encodeURIComponent which might cause problems.
            // We revert to a straight path assuming the GitHub Pages deployment handles the paths.
            // If the paths don't work, the user needs to provide the RAW GitHub URLs.
            embedElement.src = article.url + '#toolbar=0&navpanes=0&scrollbar=0'; 
            
            embedElement.className = 'w-full h-full';
            embedElement.frameBorder = '0';
            
            iframeContainer.appendChild(embedElement);
            
            // FIX: Ensure the viewer is visible
            viewerArea.style.display = 'flex';
            viewerArea.classList.remove('hidden');
            viewerArea.scrollIntoView({ behavior: 'smooth' });
        }

        function openDownloadModal(event, articleId, articleTitle) {
            event.preventDefault();
            
            // Populate modal fields
            document.getElementById('modal-download-title').textContent = articleTitle;
            document.getElementById('form-article-id').value = articleId;
            document.getElementById('form-article-title').value = articleTitle;
            
            // Reset modal state
            document.getElementById('download-form').style.display = 'block';
            document.getElementById('download-success').classList.add('hidden');
            
            // Show modal
            document.getElementById('download-modal-overlay').style.display = 'flex';
        }

        function closeDownloadModal() {
            document.getElementById('download-modal-overlay').style.display = 'none';
        }
        
        async function handleDownloadSubmit(event) {
            event.preventDefault();
            
            const form = event.target;
            const articleId = document.getElementById('form-article-id').value;
            const articleTitle = document.getElementById('form-article-title').value;
            const userName = document.getElementById('form-name').value;
            const userEmail = document.getElementById('form-email').value;
            const userOrganization = document.getElementById('form-organization').value; // Get Organization

            // Check if Firebase functions are available (required for tracking)
            if (typeof window.addDownloadRecord !== 'function') {
                console.error("Firebase tracking function is not available.");
            } else {
                // Log the download request to Firestore (asynchronous)
                await window.addDownloadRecord(articleId, articleTitle, userName, userEmail, userOrganization);
            }
            
            // Hide form and show success message with actual download link
            form.style.display = 'none';
            
            const downloadLinkElement = document.getElementById('final-download-link');
            const articleUrl = articleData[articleId].url;
            
            // Provide the direct download link (forcing download attribute)
            downloadLinkElement.href = articleUrl;
            
            document.getElementById('download-success').classList.remove('hidden');
        }

        
        // --- UTILITY FUNCTIONS ---
        
        // 1. Clock/Date Logic
        function updateClock() {
            const now = new Date();
            const timeElement = document.getElementById('time');
            const dateElement = document.getElementById('date');
            
            if (timeElement) {
                let hours = now.getHours();
                const ampm = hours >= 12 ? 'PM' : 'AM';
                hours = hours % 12;
                hours = hours ? hours : 12;
                const minutes = now.getMinutes().toString().padStart(2, '0');
                const seconds = now.getSeconds().toString().padStart(2, '0');
                timeElement.textContent = `${hours}:${minutes}:${seconds} ${ampm}`;
            }
            
            if (dateElement) {
                const options = { weekday: 'short', month: 'short', day: 'numeric' };
                dateElement.textContent = now.toLocaleDateString('en-US', options);
            }
        }

        // 2. Modal Functions (Copied from index.html)
        function showComingSoonModal(topic) {
            const modal = document.getElementById('coming-soon-modal-overlay');
            if(modal) {
                document.getElementById('modal-topic-title').textContent = topic;
                document.getElementById('modal-topic-placeholder').textContent = topic;
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }
            event.preventDefault(); 
        }

        function closeComingSoonModal() {
            const modal = document.getElementById('coming-soon-modal-overlay');
            if (modal) {
                modal.classList.add('hidden');
                document.body.style.overflow = '';
            }
        }

        // 3. Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            updateClock();
            setInterval(updateClock, 1000);

            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                const targetId = anchor.getAttribute('href');
                if (targetId === '#contact') { 
                    anchor.href = "index.html#contact"; 
                }
            });

            // Initialize Feather Icons
            if (window.feather) {
                window.feather.replace();
            }
        });
    </script>
</body>
</html>
